---
import BaseLayout from "../../layouts/BaseLayout.astro"
import { getCategories } from "../../lib/directus";
import { i18nConfig } from "../../lib/i18n";
import { getGlobals } from '../../lib/directus';
import { formatImageURL } from "../../lib/directus";

export async function getStaticPaths() {
  const language = Astro.currentLocale ?? i18nConfig.defaultLocale;

  const categories = await getCategories(language)
  const globals = await getGlobals()
  const video = typeof globals.background_video === 'object' && globals.background_video !== null
    ? globals.background_video
    : null;
  const videoURL = video ? formatImageURL(video.id, undefined, video.type) : ''

  return i18nConfig.locales.map((lang) => ({ params: { lang }, props: { videoURL, categories } }));
}

const videoURL = Astro.props.videoURL;
const categories = Astro.props.categories.filter(cat => cat.status === 'visible')
const lang = Astro.params.lang;

---
<BaseLayout showHeader={false} showFooter={false}>
  <video
    src={videoURL}
    autoplay muted loop
    class="fixed inset-0 w-auto object-cover min-h-full overflow-hidden"
  />
  <div class="absolute inset-0 flex flex-col items-center justify-center">
    <div class="absolute top-3 right-3">
      <a href={`/${lang}/about`} class="text-shadow px-3 py-2 text-xl hover:underline">About</a>
    </div>
    <a href={`/${lang}/archive`} class="mb-8">
      <h1 class="font-serif text-center text-shadow text-white text-8xl">Nes Garc&iacute;a</h1>
    </a>
    <div class="flex flex-col md:flex-row items-center gap-6">
      {categories.map((cat) => (
        <a href={`/${lang}/archive/${cat.permalink}`} class="text-shadow uppercase font-light text-3xl hover:underline">
          {cat.name}
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
<style>
  .text-shadow {
    text-shadow: 0 0 10px rgba(0,0,0,.5);
  }
  a {
    color: var(--background-light);
  }
</style>
 