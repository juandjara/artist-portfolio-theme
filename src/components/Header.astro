---
import Hamburger from "./Hamburger.astro";
import { i18nConfig } from "../lib/i18n";
import { getCategories } from "../lib/directus";

interface Props {
  favicon: string;
  menuItems: { url: string; title: string }[];
  title: string;
  description: string;
}

const favicon = Astro.props.favicon;
const title = Astro.props.title;

const localCategory = Astro.locals.previewCategory ?? null
const language = Astro.currentLocale ?? i18nConfig.defaultLocale;
let categoryId = localCategory ?? Astro.params.category ?? null

const _categories = await getCategories(language)
if (!categoryId) {
  categoryId = _categories[0]?.permalink ?? null
}

const categories = _categories.filter((c) => c.status === 'visible')

categories.push({
  background: '',
  id: 'all',
  name: 'About me',
  status: 'visible',
  permalink: '',
  postIds: [],
  blocks: [],
  link: `/${language}/about`,
})

const category = _categories.find((c) => c.permalink === categoryId)
if (category && !categories.includes(category)) {
  categories.push(category)
}

function isCatSelected(id: string) {
  return id === (categoryId ?? 'all')
}

---

<header>
  <!-- <nav class="flex flex-wrap justify-end items-center">
    <ul
      id="nav-links"
      class="md:order-0 order-10 md:w-auto w-full py-3 hidden md:flex items-center gap-1 flex-grow justify-end"
    >
      {
        items.map(({ url, title, selected }) => (
          <li>
            <a
              href={url}
              class:list={[
                { 'underline': selected },
                'uppercase block text-xl md:px-3 py-1.5 font-semibold rounded-lg'
              ]}
            >
              {title}
            </a>
          </li>
        ))
      }
    </ul>
    <div class="md:hidden flex-grow" />
    <LanguageToggle />
    <ThemeToggle />
  </nav> -->
  <div class="flex items-center gap-3 pb-4">
    <img
      class="w-20 h-20 rounded-full border-2 border-gray-300"
      src={favicon}
      alt="drawing of my face"
    />
    <h1 class="text-link text-4xl font-medium flex-grow">{title}</h1>
    <Hamburger />
    <ul class="mx-2 flex flex-wrap justify-center gap-3 flex-shrink-0">
      {categories.map((c) => (
        <li>
          <a
            href={c.link}
            class:list={[
              {
                'bg-[var(--panel-light)] dark:bg-rose-900/50': isCatSelected(c.permalink ?? ''),
                'hover:bg-[var(--panel-transparent-light)] dark:hover:bg-rose-100/20': !isCatSelected(c.permalink ?? ''),
                'opacity-50': c.status === 'protected'
              },
              'px-3 py-1 text-lg shadow hover:shadow-md transition-colors rounded-lg border border-[var(--link-light)]'
            ]}
          >{c.name}</a>
        </li>
      ))}
    </ul>
  </div>
</header>
