---
import { getCategories, getPosts, translateString } from "../../lib/directus"
import { i18nConfig } from "../../lib/i18n"
import PostGrid from '../PostGrid'

const localCategory = Astro.locals.previewCategory ?? null
const language = Astro.currentLocale ?? i18nConfig.defaultLocale;
let categoryId = localCategory ?? Astro.params.category ?? null

if (!categoryId) {
  const _categories = await getCategories(language)
  categoryId = _categories[0]?.permalink ?? null
}

const _posts = await getPosts(categoryId, language)

const { numProtected, posts } = _posts

const _labels = await Promise.all([
  translateString('loading', language),
  translateString('reveal', language),
  translateString('hidden-posts', language)
])

const labels = {
  loading: _labels[0],
  reveal: _labels[1],
  hidden: _labels[2],
}

---
<PostGrid
  client:load
  labels={labels}
  posts={posts}
  numProtected={numProtected}
  category={categoryId ?? ''}
  language={language}
/>
